begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  *  Licensed to the Apache Software Foundation (ASF) under one or more  *  contributor license agreements.  See the NOTICE file distributed with  *  this work for additional information regarding copyright ownership.  *  The ASF licenses this file to You under the Apache License, Version 2.0  *  (the "License"); you may not use this file except in compliance with  *  the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  *  Unless required by applicable law or agreed to in writing, software  *  distributed under the License is distributed on an "AS IS" BASIS,  *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  *  See the License for the specific language governing permissions and  *  limitations under the License.  *  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|plugins
operator|.
name|parser
operator|.
name|xml
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|text
operator|.
name|ParseException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|GregorianCalendar
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|descriptor
operator|.
name|Artifact
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|descriptor
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|descriptor
operator|.
name|DependencyDescriptor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|descriptor
operator|.
name|License
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|descriptor
operator|.
name|ModuleDescriptor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|descriptor
operator|.
name|Configuration
operator|.
name|Visibility
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|module
operator|.
name|id
operator|.
name|ModuleId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|core
operator|.
name|settings
operator|.
name|IvySettings
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|plugins
operator|.
name|conflict
operator|.
name|ConflictManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|plugins
operator|.
name|conflict
operator|.
name|FixedConflictManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|plugins
operator|.
name|conflict
operator|.
name|NoConflictManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|plugins
operator|.
name|matcher
operator|.
name|PatternMatcher
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|plugins
operator|.
name|parser
operator|.
name|AbstractModuleDescriptorParserTester
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ivy
operator|.
name|util
operator|.
name|XMLHelper
import|;
end_import

begin_comment
comment|/**  *   */
end_comment

begin_class
specifier|public
class|class
name|XmlModuleDescriptorParserTest
extends|extends
name|AbstractModuleDescriptorParserTester
block|{
comment|// junit test -- DO NOT REMOVE used by ant to know it's a junit test
specifier|private
name|IvySettings
name|_settings
init|=
operator|new
name|IvySettings
argument_list|()
decl_stmt|;
specifier|public
name|void
name|testSimple
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-simple.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|null
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"integration"
argument_list|,
name|md
operator|.
name|getStatus
argument_list|()
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"default"
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
index|[
literal|0
index|]
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"jar"
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
index|[
literal|0
index|]
operator|.
name|getType
argument_list|()
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getDependencies
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|md
operator|.
name|getDependencies
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEmptyDependencies
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-empty-dependencies.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myrev"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"integration"
argument_list|,
name|md
operator|.
name|getStatus
argument_list|()
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"default"
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
index|[
literal|0
index|]
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"jar"
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
index|[
literal|0
index|]
operator|.
name|getType
argument_list|()
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getDependencies
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|md
operator|.
name|getDependencies
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBad
parameter_list|()
throws|throws
name|IOException
block|{
try|try
block|{
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-bad.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad ivy file raised no error"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ParseException
name|ex
parameter_list|)
block|{
if|if
condition|(
name|XMLHelper
operator|.
name|canUseSchemaValidation
argument_list|()
condition|)
block|{
name|assertTrue
argument_list|(
literal|"exception message not explicit. It should contain 'modul', but it's:"
operator|+
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
operator|.
name|indexOf
argument_list|(
literal|"'modul'"
argument_list|)
operator|!=
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
specifier|public
name|void
name|testBadOrg
parameter_list|()
throws|throws
name|IOException
block|{
try|try
block|{
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-bad-org.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad ivy file raised no error"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ParseException
name|ex
parameter_list|)
block|{
if|if
condition|(
name|XMLHelper
operator|.
name|canUseSchemaValidation
argument_list|()
condition|)
block|{
name|assertTrue
argument_list|(
literal|"invalid exception: "
operator|+
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
operator|.
name|indexOf
argument_list|(
literal|"organization"
argument_list|)
operator|!=
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
specifier|public
name|void
name|testBadConfs
parameter_list|()
throws|throws
name|IOException
block|{
try|try
block|{
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-bad-confs.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad ivy file raised no error"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ParseException
name|ex
parameter_list|)
block|{
name|assertTrue
argument_list|(
literal|"invalid exception: "
operator|+
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
operator|.
name|indexOf
argument_list|(
literal|"invalidConf"
argument_list|)
operator|!=
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
specifier|public
name|void
name|testNoValidate
parameter_list|()
throws|throws
name|IOException
throws|,
name|ParseException
block|{
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-novalidate.xml"
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBadVersion
parameter_list|()
throws|throws
name|IOException
block|{
try|try
block|{
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-bad-version.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad version ivy file raised no error"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ParseException
name|ex
parameter_list|)
block|{
comment|// ok
block|}
block|}
specifier|public
name|void
name|testFull
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myrev"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"integration"
argument_list|,
name|md
operator|.
name|getStatus
argument_list|()
argument_list|)
expr_stmt|;
name|Date
name|pubdate
init|=
operator|new
name|GregorianCalendar
argument_list|(
literal|2004
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|11
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|getTime
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|pubdate
argument_list|,
name|md
operator|.
name|getPublicationDate
argument_list|()
argument_list|)
expr_stmt|;
name|License
index|[]
name|licenses
init|=
name|md
operator|.
name|getLicenses
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|licenses
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"MyLicense"
argument_list|,
name|licenses
index|[
literal|0
index|]
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"http://www.my.org/mymodule/mylicense.html"
argument_list|,
name|licenses
index|[
literal|0
index|]
operator|.
name|getUrl
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"http://www.my.org/mymodule/"
argument_list|,
name|md
operator|.
name|getHomePage
argument_list|()
argument_list|)
expr_stmt|;
name|Configuration
index|[]
name|confs
init|=
name|md
operator|.
name|getConfigurations
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|confs
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|confs
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertConf
argument_list|(
name|md
argument_list|,
literal|"myconf1"
argument_list|,
literal|"desc 1"
argument_list|,
name|Configuration
operator|.
name|Visibility
operator|.
name|PUBLIC
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertConf
argument_list|(
name|md
argument_list|,
literal|"myconf2"
argument_list|,
literal|"desc 2"
argument_list|,
name|Configuration
operator|.
name|Visibility
operator|.
name|PUBLIC
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertConf
argument_list|(
name|md
argument_list|,
literal|"myconf3"
argument_list|,
literal|"desc 3"
argument_list|,
name|Configuration
operator|.
name|Visibility
operator|.
name|PRIVATE
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertConf
argument_list|(
name|md
argument_list|,
literal|"myconf4"
argument_list|,
literal|"desc 4"
argument_list|,
name|Configuration
operator|.
name|Visibility
operator|.
name|PUBLIC
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|}
argument_list|)
expr_stmt|;
name|assertConf
argument_list|(
name|md
argument_list|,
literal|"myoldconf"
argument_list|,
literal|"my old desc"
argument_list|,
name|Configuration
operator|.
name|Visibility
operator|.
name|PUBLIC
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertArtifacts
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myartifact1"
block|,
literal|"myartifact2"
block|,
literal|"myartifact3"
block|,
literal|"myartifact4"
block|}
argument_list|)
expr_stmt|;
name|assertArtifacts
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"myconf2"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myartifact1"
block|,
literal|"myartifact3"
block|}
argument_list|)
expr_stmt|;
name|assertArtifacts
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"myconf3"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myartifact1"
block|,
literal|"myartifact3"
block|,
literal|"myartifact4"
block|}
argument_list|)
expr_stmt|;
name|assertArtifacts
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"myconf4"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myartifact1"
block|}
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|13
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => equivalent to *->*
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"2.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|dd
operator|.
name|isChanging
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|dd
operator|.
name|isTransitive
argument_list|()
argument_list|)
expr_stmt|;
comment|// changing = true
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule3"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|dd
operator|.
name|isChanging
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|dd
operator|.
name|isTransitive
argument_list|()
argument_list|)
expr_stmt|;
comment|// conf="myconf1" => equivalent to myconf1->myconf1
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule1"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// conf="myconf1->yourconf1"
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule2"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"2+"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// conf="myconf1->yourconf1, yourconf2"
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule3"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"3.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|,
literal|"yourconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// conf="myconf1, myconf2->yourconf1, yourconf2"
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule4"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"4.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|,
literal|"yourconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|,
literal|"yourconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// conf="myconf1->yourconf1;myconf2->yourconf1, yourconf2"
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule5"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"5.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|,
literal|"yourconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// conf="*->@"
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule11"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"11.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf3"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf4"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf4"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule6"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"latest.integration"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|,
literal|"yourconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule7"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"7.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"yourconf1"
block|,
literal|"yourconf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"myconf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|,
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule8"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"8.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact8-1"
block|,
literal|"yourartifact8-2"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact8-1"
block|,
literal|"yourartifact8-2"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact8-1"
block|,
literal|"yourartifact8-2"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact8-1"
block|,
literal|"yourartifact8-2"
block|}
argument_list|)
expr_stmt|;
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule9"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"9.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|,
literal|"myconf2"
block|,
literal|"myconf3"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact9-1"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact9-1"
block|,
literal|"yourartifact9-2"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"yourartifact9-2"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{}
argument_list|)
expr_stmt|;
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"yourmodule10"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"yourorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"10.1"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"your.*"
block|,
name|PatternMatcher
operator|.
name|ANY_EXPRESSION
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"your.*"
block|,
name|PatternMatcher
operator|.
name|ANY_EXPRESSION
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"your.*"
block|,
name|PatternMatcher
operator|.
name|ANY_EXPRESSION
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsIncludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"your.*"
block|,
name|PatternMatcher
operator|.
name|ANY_EXPRESSION
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"toexclude"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"toexclude"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf3"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"toexclude"
block|}
argument_list|)
expr_stmt|;
name|assertDependencyArtifactsExcludes
argument_list|(
name|dd
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf4"
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"toexclude"
block|}
argument_list|)
expr_stmt|;
name|ConflictManager
name|cm
init|=
name|md
operator|.
name|getConflictManager
argument_list|(
operator|new
name|ModuleId
argument_list|(
literal|"yourorg"
argument_list|,
literal|"yourmodule1"
argument_list|)
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|cm
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|cm
operator|instanceof
name|NoConflictManager
argument_list|)
expr_stmt|;
name|cm
operator|=
name|md
operator|.
name|getConflictManager
argument_list|(
operator|new
name|ModuleId
argument_list|(
literal|"yourorg"
argument_list|,
literal|"yourmodule2"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|cm
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|cm
operator|instanceof
name|NoConflictManager
argument_list|)
expr_stmt|;
name|cm
operator|=
name|md
operator|.
name|getConflictManager
argument_list|(
operator|new
name|ModuleId
argument_list|(
literal|"theirorg"
argument_list|,
literal|"theirmodule1"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|cm
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|cm
operator|instanceof
name|FixedConflictManager
argument_list|)
expr_stmt|;
name|FixedConflictManager
name|fcm
init|=
operator|(
name|FixedConflictManager
operator|)
name|cm
decl_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|fcm
operator|.
name|getRevs
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|fcm
operator|.
name|getRevs
argument_list|()
operator|.
name|contains
argument_list|(
literal|"1.0"
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|fcm
operator|.
name|getRevs
argument_list|()
operator|.
name|contains
argument_list|(
literal|"1.1"
argument_list|)
argument_list|)
expr_stmt|;
name|cm
operator|=
name|md
operator|.
name|getConflictManager
argument_list|(
operator|new
name|ModuleId
argument_list|(
literal|"theirorg"
argument_list|,
literal|"theirmodule2"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNull
argument_list|(
name|cm
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBug60
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-bug60.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myrev"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"integration"
argument_list|,
name|md
operator|.
name|getStatus
argument_list|()
argument_list|)
expr_stmt|;
name|Date
name|pubdate
init|=
operator|new
name|GregorianCalendar
argument_list|(
literal|2004
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|11
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|getTime
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|pubdate
argument_list|,
name|md
operator|.
name|getPublicationDate
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"default"
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertArtifacts
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myartifact1"
block|,
literal|"myartifact2"
block|}
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testNoArtifact
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-noartifact.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|null
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"integration"
argument_list|,
name|md
operator|.
name|getStatus
argument_list|()
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"default"
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getDependencies
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|md
operator|.
name|getDependencies
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testNoPublication
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-nopublication.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mymodule"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myrev"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"integration"
argument_list|,
name|md
operator|.
name|getStatus
argument_list|()
argument_list|)
expr_stmt|;
name|Date
name|pubdate
init|=
operator|new
name|GregorianCalendar
argument_list|(
literal|2004
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|11
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|getTime
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|pubdate
argument_list|,
name|md
operator|.
name|getPublicationDate
argument_list|()
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"default"
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|md
operator|.
name|getDependencies
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|md
operator|.
name|getDependencies
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testArtifactsDefaults
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-artifacts-defaults.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|Artifact
index|[]
name|artifacts
init|=
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|artifacts
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|artifacts
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertArtifactEquals
argument_list|(
literal|"mymodule"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|artifacts
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertArtifactEquals
argument_list|(
literal|"myartifact"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|artifacts
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|assertArtifactEquals
argument_list|(
literal|"mymodule"
argument_list|,
literal|"dll"
argument_list|,
literal|"dll"
argument_list|,
name|artifacts
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|assertArtifactEquals
parameter_list|(
name|String
name|name
parameter_list|,
name|String
name|type
parameter_list|,
name|String
name|ext
parameter_list|,
name|Artifact
name|artifact
parameter_list|)
block|{
name|assertEquals
argument_list|(
name|name
operator|+
literal|"/"
operator|+
name|type
operator|+
literal|"/"
operator|+
name|ext
argument_list|,
name|artifact
operator|.
name|getName
argument_list|()
operator|+
literal|"/"
operator|+
name|artifact
operator|.
name|getType
argument_list|()
operator|+
literal|"/"
operator|+
name|artifact
operator|.
name|getExt
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testDefaultConf
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-defaultconf.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => defaults to defaultConf: default
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"default"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs def: *->*
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"2.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"default"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testDefaultConf2
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-defaultconf2.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => defaults to defaultConf: *->default
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"default"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"test"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs def: test: should not use default conf for the right side (use of defaultconfmapping is required for that) => test->test
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"2.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"test"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testDefaultConfMapping
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-defaultconfmapping.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => defaults to defaultConf: *->default
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"default"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"test"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs def: test: should use default conf mapping for the right side => test->default
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"2.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"test"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testExtraAttributes
parameter_list|()
throws|throws
name|Exception
block|{
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-extra-attributes.xml"
argument_list|)
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"infoextravalue"
argument_list|,
name|md
operator|.
name|getAttribute
argument_list|(
literal|"infoextra"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"infoextravalue"
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getAttribute
argument_list|(
literal|"infoextra"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"confextravalue"
argument_list|,
name|md
operator|.
name|getConfiguration
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getAttribute
argument_list|(
literal|"confextra"
argument_list|)
argument_list|)
expr_stmt|;
name|Artifact
index|[]
name|artifacts
init|=
name|md
operator|.
name|getArtifacts
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|artifacts
operator|.
name|length
argument_list|)
expr_stmt|;
name|Artifact
name|art
init|=
name|artifacts
index|[
literal|0
index|]
decl_stmt|;
name|assertEquals
argument_list|(
literal|"art1"
argument_list|,
name|art
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"artextravalue"
argument_list|,
name|art
operator|.
name|getAttribute
argument_list|(
literal|"artextra"
argument_list|)
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dd
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"myorg"
argument_list|,
name|dd
operator|.
name|getDependencyId
argument_list|()
operator|.
name|getOrganisation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.0"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"depextravalue"
argument_list|,
name|dd
operator|.
name|getAttribute
argument_list|(
literal|"depextra"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"depextravalue"
argument_list|,
name|dd
operator|.
name|getDependencyRevisionId
argument_list|()
operator|.
name|getAttribute
argument_list|(
literal|"depextra"
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testImportConfigurations1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configurations-import1.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// should have imported configurations
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"conf1"
argument_list|,
name|Visibility
operator|.
name|PUBLIC
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|,
operator|new
name|Configuration
argument_list|(
literal|"conf2"
argument_list|,
name|Visibility
operator|.
name|PRIVATE
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => defaults to defaultConf: *->*
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs def: conf1->*
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testImportConfigurations2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and add another one
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configurations-import2.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// should have imported configurations and added the one defined in the file itself
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"conf1"
argument_list|,
name|Visibility
operator|.
name|PUBLIC
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|,
operator|new
name|Configuration
argument_list|(
literal|"conf2"
argument_list|,
name|Visibility
operator|.
name|PRIVATE
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|,
operator|new
name|Configuration
argument_list|(
literal|"conf3"
argument_list|,
name|Visibility
operator|.
name|PUBLIC
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => defaults to defaultConf: *->*
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs def: conf2,conf3->*
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf2"
block|,
literal|"conf3"
block|}
argument_list|)
argument_list|)
argument_list|,
operator|new
name|HashSet
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf3"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testImportConfigurations3
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and default mapping
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configurations-import3.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// should have imported configurations
name|assertNotNull
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|Configuration
index|[]
block|{
operator|new
name|Configuration
argument_list|(
literal|"conf1"
argument_list|,
name|Visibility
operator|.
name|PUBLIC
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|,
operator|new
name|Configuration
argument_list|(
literal|"conf2"
argument_list|,
name|Visibility
operator|.
name|PRIVATE
argument_list|,
literal|""
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|md
operator|.
name|getConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// no conf def => defaults to defaultConf defined in imported file: *->@
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs def: conf1->*
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testExtendOtherConfigs
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and default mapping
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configextendsothers1.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// has an 'all-public' configuration
name|Configuration
name|allPublic
init|=
name|md
operator|.
name|getConfiguration
argument_list|(
literal|"all-public"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|allPublic
argument_list|)
expr_stmt|;
comment|// 'all-public' extends all other public configurations
name|String
index|[]
name|allPublicExt
init|=
name|allPublic
operator|.
name|getExtends
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"test"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|allPublicExt
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testImportConfigurationsWithExtendOtherConfigs
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and default mapping
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configextendsothers2.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// has an 'all-public' configuration
name|Configuration
name|allPublic
init|=
name|md
operator|.
name|getConfiguration
argument_list|(
literal|"all-public"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|allPublic
argument_list|)
expr_stmt|;
comment|// 'all-public' extends all other public configurations
name|String
index|[]
name|allPublicExt
init|=
name|allPublic
operator|.
name|getExtends
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"test"
block|,
literal|"extra"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|allPublicExt
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testImportConfigurationsWithMappingOverride
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and default mapping
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configurations-import4.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// has 2 dependencies
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// confs dep1: conf1->A;conf2->B (mappingoverride = true)
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf2"
block|,
literal|"conf1"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"A"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf1"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"B"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs dep2: conf2->B
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"conf2"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"B"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"conf2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testImportConfigurationsWithWildcardAndMappingOverride
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and default mapping
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-configextendsothers3.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// has 2 dependencies
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// confs dep1: all-public->all-public (mappingoverride = true)
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"all-public"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"all-public"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"all-public"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs dep2: extra->extra;all-public->all-public (mappingoverride = true)
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"all-public"
block|,
literal|"extra"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"extra"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"extra"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"all-public"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"all-public"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testDefaultConfMappingWithSelectors
parameter_list|()
throws|throws
name|Exception
block|{
comment|// import configurations and default mapping
name|ModuleDescriptor
name|md
init|=
name|XmlModuleDescriptorParser
operator|.
name|getInstance
argument_list|()
operator|.
name|parseDescriptor
argument_list|(
name|_settings
argument_list|,
name|getClass
argument_list|()
operator|.
name|getResource
argument_list|(
literal|"test-defaultconfmapping-withselectors.xml"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
comment|// has 3 dependencies
name|DependencyDescriptor
index|[]
name|dependencies
init|=
name|md
operator|.
name|getDependencies
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|dependencies
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|dependencies
operator|.
name|length
argument_list|)
expr_stmt|;
comment|// confs dep1: *->default1,default3
name|DependencyDescriptor
name|dd
init|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default1"
block|,
literal|"default3"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"default"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs dep2: test->default2,default3
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule2"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default2"
block|,
literal|"default3"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"test"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// confs dep3: *->default4
name|dd
operator|=
name|getDependency
argument_list|(
name|dependencies
argument_list|,
literal|"mymodule3"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getModuleConfigurations
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"default4"
block|}
argument_list|)
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|dd
operator|.
name|getDependencyConfigurations
argument_list|(
literal|"bla"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

