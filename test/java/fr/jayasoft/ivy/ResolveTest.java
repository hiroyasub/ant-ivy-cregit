begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * This file is subject to the license found in LICENCE.TXT in the root directory of the project.  *   * #SNAPSHOT#  */
end_comment

begin_package
package|package
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParser
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParserFactory
import|;
end_import

begin_import
import|import
name|junit
operator|.
name|framework
operator|.
name|TestCase
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|tools
operator|.
name|ant
operator|.
name|Project
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|tools
operator|.
name|ant
operator|.
name|taskdefs
operator|.
name|Delete
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|helpers
operator|.
name|DefaultHandler
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|ConfigurationResolveReport
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|ResolveReport
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|XmlReportOutputter
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|resolver
operator|.
name|DualResolver
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|util
operator|.
name|FileUtil
import|;
end_import

begin_comment
comment|/**  * @author Xavier Hanin  *  */
end_comment

begin_class
specifier|public
class|class
name|ResolveTest
extends|extends
name|TestCase
block|{
specifier|private
specifier|final
name|Ivy
name|_ivy
decl_stmt|;
specifier|private
name|File
name|_cache
decl_stmt|;
specifier|public
name|ResolveTest
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|=
operator|new
name|Ivy
argument_list|()
expr_stmt|;
name|_ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|protected
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|createCache
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|createCache
parameter_list|()
block|{
name|_cache
operator|=
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
expr_stmt|;
name|_cache
operator|.
name|mkdirs
argument_list|()
expr_stmt|;
block|}
specifier|protected
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|cleanCache
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|cleanCache
parameter_list|()
block|{
name|Delete
name|del
init|=
operator|new
name|Delete
argument_list|()
decl_stmt|;
name|del
operator|.
name|setProject
argument_list|(
operator|new
name|Project
argument_list|()
argument_list|)
expr_stmt|;
name|del
operator|.
name|setDir
argument_list|(
name|_cache
argument_list|)
expr_stmt|;
name|del
operator|.
name|execute
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveSimple
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.1 depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testChangeCacheLayout
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|setCacheIvyPattern
argument_list|(
literal|"[module]/ivy.xml"
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|setCacheArtifactPattern
argument_list|(
literal|"[artifact].[ext]"
argument_list|)
expr_stmt|;
comment|// mod1.1 depends on mod1.2
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"mod1.1/ivy.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"mod1.2/ivy.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"mod1.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.1 depends on mod1.2 2.0 in conf default, and conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"extension"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies from default
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExtended
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.1 depends on mod1.2 2.0 in conf default, and conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies from default
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExtendedAndExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.1 depends on mod1.2 2.0 in conf default, and conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"extension"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"extension"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDefaultWithArtifactsConf1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.2 depends on mod1.3 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.2/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.2"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDefaultWithArtifactsConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.2 depends on mod1.3 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.2/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.2"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithDependencyArtifactsConf1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts in myconf1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithDependencyArtifactsConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts in myconf1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithDependencyArtifactsWithoutConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithExcludesArtifacts
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.6.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.6"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveDependencies
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.1 depends on mod1.1 which depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDiamond
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 depends on
comment|//   - mod1.1 which depends on mod1.2
comment|//   - mod3.1 which depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveConflict
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.1 depends on
comment|//   - mod1.1 v 1.0 which depends on mod1.2 v 2.0
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|File
name|r
init|=
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
name|XmlReportOutputter
operator|.
name|getReportFileName
argument_list|(
name|mrid
operator|.
name|getModuleId
argument_list|()
argument_list|,
literal|"default"
argument_list|)
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|r
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
specifier|final
name|boolean
index|[]
name|found
init|=
operator|new
name|boolean
index|[]
block|{
literal|false
block|}
decl_stmt|;
name|SAXParser
name|saxParser
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|r
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
block|{
specifier|public
name|void
name|startElement
parameter_list|(
name|String
name|uri
parameter_list|,
name|String
name|localName
parameter_list|,
name|String
name|qName
parameter_list|,
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|Attributes
name|attributes
parameter_list|)
throws|throws
name|SAXException
block|{
if|if
condition|(
literal|"revision"
operator|.
name|equals
argument_list|(
name|qName
argument_list|)
operator|&&
literal|"2.0"
operator|.
name|equals
argument_list|(
name|attributes
operator|.
name|getValue
argument_list|(
literal|"name"
argument_list|)
argument_list|)
condition|)
block|{
name|found
index|[
literal|0
index|]
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|found
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// the report should contain the evicted revision
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testTransitiveEviction
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod7.3 depends on mod7.2 v1.0 and on mod7.1 v2.0
comment|//      mod7.2 v1.0 depends on mod7.1 v1.0 (which then should be evicted)
comment|//      mod7.1 v1.0 depends on mod 1.2 v1.0 (which should be evicted by transitivity)
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod7.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org7"
argument_list|,
literal|"mod7.3"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org7"
argument_list|,
literal|"mod7.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org7"
argument_list|,
literal|"mod7.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod7.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org7"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org7"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org7"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveConflictInConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// conflicts in separate confs are not conflicts
comment|// mod2.1 conf A depends on mod1.1 which depends on mod1.2 2.0
comment|// mod2.1 conf B depends on mod1.2 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.1/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// bug 105 - test #1
comment|// mod6.1 r1.0 depends on
comment|//       mod5.1 r4.2 conf A
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// should have been evicted before download
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as preceding one but with inverse order, so that
comment|// eviction is done after download
comment|// bug 105 - test #2
comment|// mod6.1 r1.1 depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//       mod5.1 r4.2 conf A
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConfInMultiConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as preceding ones but the conflict appears in several root confs
comment|// bug 105 - test #3
comment|// mod6.1 r1.2 conf A and conf B depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//       mod5.1 r4.2 conf A
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.2"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// all artifacts should be present in both confs
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"A"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"B"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConfInMultiConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as preceding one but the conflict appears in a root conf and not in another
comment|// which should keep the evicted
comment|// bug 105 - test #4
comment|// mod6.1 r1.3 conf A depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//
comment|// mod6.1 r1.3 conf B depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//       mod5.1 r4.2 conf A
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// 4.2 artifacts should be present in conf B only
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"A"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"B"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForce
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.2 depends on
comment|//   - mod1.2 v 2.0 and forces it
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.2"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 5.2 depends on mod5.1 conf B
comment|// mod5.1 conf B publishes art51B
comment|// mod5.1 conf B extends conf A
comment|// mod5.1 conf A publishes art51A
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod5.2/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testMultiConfs
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 5.2 depends on mod5.1 conf B in its conf B and conf A in its conf A
comment|// mod5.1 conf B publishes art51B
comment|// mod5.1 conf A publishes art51A
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod5.2/ivy-2.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"B"
block|,
literal|"A"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"2.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ModuleRevisionId
name|depId
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"A"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|depId
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|File
name|r
init|=
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
name|XmlReportOutputter
operator|.
name|getReportFileName
argument_list|(
name|mrid
operator|.
name|getModuleId
argument_list|()
argument_list|,
literal|"A"
argument_list|)
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|r
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
specifier|final
name|boolean
index|[]
name|found
init|=
operator|new
name|boolean
index|[]
block|{
literal|false
block|}
decl_stmt|;
name|SAXParser
name|saxParser
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|r
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
block|{
specifier|public
name|void
name|startElement
parameter_list|(
name|String
name|uri
parameter_list|,
name|String
name|localName
parameter_list|,
name|String
name|qName
parameter_list|,
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|Attributes
name|attributes
parameter_list|)
throws|throws
name|SAXException
block|{
if|if
condition|(
literal|"artifact"
operator|.
name|equals
argument_list|(
name|qName
argument_list|)
operator|&&
literal|"art51B"
operator|.
name|equals
argument_list|(
name|attributes
operator|.
name|getValue
argument_list|(
literal|"name"
argument_list|)
argument_list|)
condition|)
block|{
name|found
index|[
literal|0
index|]
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|found
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|depId
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testLatest
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.4 depends on latest mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.4/ivys/ivy-1.0.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.4"
argument_list|,
literal|"1.0.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ModuleRevisionId
name|depId
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|depId
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|File
name|r
init|=
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
name|XmlReportOutputter
operator|.
name|getReportFileName
argument_list|(
name|mrid
operator|.
name|getModuleId
argument_list|()
argument_list|,
literal|"default"
argument_list|)
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|r
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
specifier|final
name|boolean
index|[]
name|found
init|=
operator|new
name|boolean
index|[]
block|{
literal|false
block|}
decl_stmt|;
name|SAXParser
name|saxParser
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|r
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
block|{
specifier|public
name|void
name|startElement
parameter_list|(
name|String
name|uri
parameter_list|,
name|String
name|localName
parameter_list|,
name|String
name|qName
parameter_list|,
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|Attributes
name|attributes
parameter_list|)
throws|throws
name|SAXException
block|{
if|if
condition|(
literal|"artifact"
operator|.
name|equals
argument_list|(
name|qName
argument_list|)
operator|&&
literal|"mod1.2"
operator|.
name|equals
argument_list|(
name|attributes
operator|.
name|getValue
argument_list|(
literal|"name"
argument_list|)
argument_list|)
condition|)
block|{
name|found
index|[
literal|0
index|]
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|found
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|depId
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testIVY56
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bugIVY-56/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-56.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testCircular
parameter_list|()
throws|throws
name|Exception
block|{
try|try
block|{
comment|// mod6.3 depends on mod6.2, which itself depends on mod6.3 !
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|fail
argument_list|(
literal|"should have thrown a circular dependency exception"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|CircularDependencyException
name|e
parameter_list|)
block|{
comment|//successfull
block|}
block|}
specifier|public
name|void
name|testResolveDualChain
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"dualchainresolverconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|DependencyResolver
name|resolver
init|=
name|ivy
operator|.
name|getResolver
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|resolver
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|resolver
operator|instanceof
name|DualResolver
argument_list|)
expr_stmt|;
name|DualResolver
name|dual
init|=
operator|(
name|DualResolver
operator|)
name|resolver
decl_stmt|;
comment|// first without cache
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-dualchainresolver.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/ivy-2.6.2.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// second with cache for ivy file only
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|assertFalse
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-dualchainresolver.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/ivy-2.6.2.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBug148
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bug148/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-148.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/ivy-1.1.0.0.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/jars/bar-1.1.0.0.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/ivy-4.10.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/jars/LinearBarCode-4.10.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBug148b
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bug148/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-148b.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/ivy-1.1.0.0.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/jars/bar-1.1.0.0.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/ivy-4.10.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/jars/LinearBarCode-4.10.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBadFiles
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
try|try
block|{
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivys/ivy-badorg.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad org should have raised an exception !"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|// OK, it raised an exception
block|}
try|try
block|{
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivys/ivy-badmodule.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad module should have raised an exception !"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|// OK, it raised an exception
block|}
try|try
block|{
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivys/ivy-badrevision.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad revision should have raised an exception !"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|// OK, it raised an exception
block|}
block|}
specifier|public
name|void
name|testTransitiveSetting
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.4 depends on mod1.1 with transitive set to false
comment|//     mod1.1 depends on mod1.2, which should not be resolved because of the transitive setting
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.4/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.4"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolverDirectlyUsingCache
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"badcacheconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|File
name|depIvyFileInCache
init|=
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
decl_stmt|;
name|FileUtil
operator|.
name|copy
argument_list|(
name|File
operator|.
name|createTempFile
argument_list|(
literal|"test"
argument_list|,
literal|"xml"
argument_list|)
argument_list|,
name|depIvyFileInCache
argument_list|,
literal|null
argument_list|)
expr_stmt|;
comment|// creates a fake dependency file in cache
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.4/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.4"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|depIvyFileInCache
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

