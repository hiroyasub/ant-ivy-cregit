begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * This file is subject to the license found in LICENCE.TXT in the root directory of the project.  *   * #SNAPSHOT#  */
end_comment

begin_package
package|package
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParser
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParserFactory
import|;
end_import

begin_import
import|import
name|junit
operator|.
name|framework
operator|.
name|TestCase
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|tools
operator|.
name|ant
operator|.
name|Project
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|tools
operator|.
name|ant
operator|.
name|taskdefs
operator|.
name|Delete
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|helpers
operator|.
name|DefaultHandler
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|circular
operator|.
name|CircularDependencyException
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|circular
operator|.
name|ErrorCircularDependencyStrategy
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|circular
operator|.
name|IgnoreCircularDependencyStrategy
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|circular
operator|.
name|WarnCircularDependencyStrategy
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|conflict
operator|.
name|LatestConflictManager
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|latest
operator|.
name|LatestRevisionStrategy
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|ArtifactDownloadReport
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|ConfigurationResolveReport
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|DownloadStatus
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|ResolveReport
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|report
operator|.
name|XmlReportOutputter
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|resolver
operator|.
name|BasicResolver
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|resolver
operator|.
name|DualResolver
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|resolver
operator|.
name|FileSystemResolver
import|;
end_import

begin_import
import|import
name|fr
operator|.
name|jayasoft
operator|.
name|ivy
operator|.
name|util
operator|.
name|FileUtil
import|;
end_import

begin_comment
comment|/**  * @author Xavier Hanin  *  */
end_comment

begin_class
specifier|public
class|class
name|ResolveTest
extends|extends
name|TestCase
block|{
specifier|private
specifier|final
name|Ivy
name|_ivy
decl_stmt|;
specifier|private
name|File
name|_cache
decl_stmt|;
specifier|public
name|ResolveTest
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|=
operator|new
name|Ivy
argument_list|()
expr_stmt|;
name|_ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|protected
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|createCache
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|createCache
parameter_list|()
block|{
name|_cache
operator|=
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
expr_stmt|;
name|_cache
operator|.
name|mkdirs
argument_list|()
expr_stmt|;
block|}
specifier|protected
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|cleanCache
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|cleanCache
parameter_list|()
block|{
name|Delete
name|del
init|=
operator|new
name|Delete
argument_list|()
decl_stmt|;
name|del
operator|.
name|setProject
argument_list|(
operator|new
name|Project
argument_list|()
argument_list|)
expr_stmt|;
name|del
operator|.
name|setDir
argument_list|(
name|_cache
argument_list|)
expr_stmt|;
name|del
operator|.
name|execute
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithRetainingArtifactName
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|.
name|setCacheArtifactPattern
argument_list|(
name|_ivy
operator|.
name|substitute
argument_list|(
literal|"[module]/[originalname].[ext]"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod15.2/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ArtifactDownloadReport
index|[]
name|dReports
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org15"
argument_list|,
literal|"mod15.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dReports
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"number of downloaded artifacts not correct"
argument_list|,
literal|1
argument_list|,
name|dReports
operator|.
name|length
argument_list|)
expr_stmt|;
name|Artifact
name|artifact
init|=
name|dReports
index|[
literal|0
index|]
operator|.
name|getArtifact
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|artifact
argument_list|)
expr_stmt|;
name|String
name|cachePath
init|=
name|_ivy
operator|.
name|getArchivePathInCache
argument_list|(
name|artifact
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
literal|"artifact name has not been retained: "
operator|+
name|cachePath
argument_list|,
name|cachePath
operator|.
name|endsWith
argument_list|(
literal|"library.jar"
argument_list|)
argument_list|)
expr_stmt|;
name|dReports
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dReports
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"number of downloaded artifacts not correct"
argument_list|,
literal|1
argument_list|,
name|dReports
operator|.
name|length
argument_list|)
expr_stmt|;
name|artifact
operator|=
name|dReports
index|[
literal|0
index|]
operator|.
name|getArtifact
argument_list|()
expr_stmt|;
name|assertNotNull
argument_list|(
name|artifact
argument_list|)
expr_stmt|;
name|cachePath
operator|=
name|_ivy
operator|.
name|getArchivePathInCache
argument_list|(
name|artifact
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"artifact name has not been retained: "
operator|+
name|cachePath
argument_list|,
name|cachePath
operator|.
name|endsWith
argument_list|(
literal|"mod14.1-1.1.jar"
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testArtifactOrigin
parameter_list|()
throws|throws
name|Exception
block|{
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ArtifactDownloadReport
index|[]
name|dReports
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|dReports
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"number of downloaded artifacts not correct"
argument_list|,
literal|1
argument_list|,
name|dReports
operator|.
name|length
argument_list|)
expr_stmt|;
name|Artifact
name|artifact
init|=
name|dReports
index|[
literal|0
index|]
operator|.
name|getArtifact
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|artifact
argument_list|)
expr_stmt|;
name|String
name|expectedLocation
init|=
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.2/jars/mod1.2-2.0.jar"
argument_list|)
operator|.
name|getAbsolutePath
argument_list|()
decl_stmt|;
comment|// verify the origin in the report
name|ArtifactOrigin
name|reportOrigin
init|=
name|dReports
index|[
literal|0
index|]
operator|.
name|getArtifactOrigin
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|reportOrigin
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"isLocal for artifact not correct"
argument_list|,
literal|true
argument_list|,
name|reportOrigin
operator|.
name|isLocal
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"location for artifact not correct"
argument_list|,
name|expectedLocation
argument_list|,
name|reportOrigin
operator|.
name|getLocation
argument_list|()
argument_list|)
expr_stmt|;
comment|// verify the saved origin on disk
name|ArtifactOrigin
name|ivyOrigin
init|=
name|_ivy
operator|.
name|getSavedArtifactOrigin
argument_list|(
name|_cache
argument_list|,
name|artifact
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|ivyOrigin
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"isLocal for artifact not correct"
argument_list|,
literal|true
argument_list|,
name|ivyOrigin
operator|.
name|isLocal
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"location for artifact not correct"
argument_list|,
name|expectedLocation
argument_list|,
name|ivyOrigin
operator|.
name|getLocation
argument_list|()
argument_list|)
expr_stmt|;
comment|// now resolve the same artifact again and verify the origin of the (not-downloaded) artifact
name|report
operator|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|dReports
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|dReports
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"number of downloaded artifacts not correct"
argument_list|,
literal|1
argument_list|,
name|dReports
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"download status not correct"
argument_list|,
name|DownloadStatus
operator|.
name|NO
argument_list|,
name|dReports
index|[
literal|0
index|]
operator|.
name|getDownloadStatus
argument_list|()
argument_list|)
expr_stmt|;
name|reportOrigin
operator|=
name|dReports
index|[
literal|0
index|]
operator|.
name|getArtifactOrigin
argument_list|()
expr_stmt|;
name|assertNotNull
argument_list|(
name|reportOrigin
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"isLocal for artifact not correct"
argument_list|,
literal|true
argument_list|,
name|reportOrigin
operator|.
name|isLocal
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"location for artifact not correct"
argument_list|,
name|expectedLocation
argument_list|,
name|reportOrigin
operator|.
name|getLocation
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveSimple
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.1 depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveBadStatus
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.4 depends on modfailure, modfailure has a bad status
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.4/ivys/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveNoRevisionInPattern
parameter_list|()
throws|throws
name|Exception
block|{
comment|// module1 depends on latest version of module2, for which there is no revision in the pattern
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/norev/ivyconf.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/norev/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveNoRevisionInDep
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.4 depends on mod1.6, in which the ivy file has no revision
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.4/ivys/ivy-1.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveNoRevisionNowhere
parameter_list|()
throws|throws
name|Exception
block|{
comment|// test case for IVY-258
comment|// module1 depends on latest version of module2, which contains no revision in its ivy file, nor in the pattern
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-258/ivyconf.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-258/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
operator|(
operator|(
name|BasicResolver
operator|)
name|ivy
operator|.
name|getResolver
argument_list|(
literal|"myresolver"
argument_list|)
operator|)
operator|.
name|setCheckconsistency
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|report
operator|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-258/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveRequiresIvyFile
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.1 depends on mod1.2, mod1.2 has no ivy file
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|(
name|FileSystemResolver
operator|)
name|ivy
operator|.
name|getResolver
argument_list|(
literal|"1"
argument_list|)
operator|)
operator|.
name|setAllownomd
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveOtherConfiguration
parameter_list|()
throws|throws
name|Exception
block|{
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-other.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Number of artifacts not correct"
argument_list|,
literal|1
argument_list|,
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"test"
argument_list|)
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithSlashes
parameter_list|()
throws|throws
name|Exception
block|{
comment|// test case for IVY-198
comment|// module depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-198.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"myorg/mydep"
argument_list|,
literal|"system/module"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"yourorg/yourdep"
argument_list|,
literal|"yoursys/yourmod"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"yourorg/yourdep"
argument_list|,
literal|"yoursys/yourmod"
argument_list|,
literal|"1.0"
argument_list|,
literal|"yourmod"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testFromCache
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.1 depends on mod1.2
comment|// we first do a simple resolve so that module is in cache
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// we now use a badly configured ivy, so that it can't find module in repository
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bugIVY-56/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testFromCache2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.1 depends on mod1.2
comment|// configuration
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|DualResolver
name|resolver
init|=
operator|new
name|DualResolver
argument_list|()
decl_stmt|;
name|resolver
operator|.
name|setName
argument_list|(
literal|"dual"
argument_list|)
expr_stmt|;
name|FileSystemResolver
name|r
init|=
operator|new
name|FileSystemResolver
argument_list|()
decl_stmt|;
name|r
operator|.
name|setName
argument_list|(
literal|"1"
argument_list|)
expr_stmt|;
name|r
operator|.
name|addArtifactPattern
argument_list|(
literal|"build/testCache2/[artifact]-[revision].[ext]"
argument_list|)
expr_stmt|;
name|resolver
operator|.
name|add
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|r
operator|=
operator|new
name|FileSystemResolver
argument_list|()
expr_stmt|;
name|r
operator|.
name|setName
argument_list|(
literal|"2"
argument_list|)
expr_stmt|;
name|r
operator|.
name|addArtifactPattern
argument_list|(
literal|"build/testCache2/[artifact]-[revision].[ext]"
argument_list|)
expr_stmt|;
name|resolver
operator|.
name|add
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|addResolver
argument_list|(
name|resolver
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|setDefaultResolver
argument_list|(
literal|"dual"
argument_list|)
expr_stmt|;
comment|// set up repository
name|File
name|art
init|=
operator|new
name|File
argument_list|(
literal|"build/testCache2/mod1.2-2.0.jar"
argument_list|)
decl_stmt|;
name|FileUtil
operator|.
name|copy
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.2/jars/mod1.2-2.0.jar"
argument_list|)
argument_list|,
name|art
argument_list|,
literal|null
argument_list|)
expr_stmt|;
comment|// we first do a simple resolve so that module is in cache
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
comment|// now we clean the repository to simulate repo not available (network pb for instance)
name|Delete
name|del
init|=
operator|new
name|Delete
argument_list|()
decl_stmt|;
name|del
operator|.
name|setProject
argument_list|(
operator|new
name|Project
argument_list|()
argument_list|)
expr_stmt|;
name|del
operator|.
name|setDir
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/testCache2"
argument_list|)
argument_list|)
expr_stmt|;
name|del
operator|.
name|execute
argument_list|()
expr_stmt|;
comment|// now do a new resolve: it should use cached data
name|report
operator|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testFromCacheOnly
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bugIVY-56/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
comment|//        ResolveReport report = ivy.resolve(new File("test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml").toURL(),
comment|//                null, new String[] {"*"}, _cache, null, true);
comment|//        // should have an error, the conf is bad and the dependency should not be found
comment|//        assertTrue(report.hasError());
comment|// put necessary stuff in cache, and it should now be ok
name|File
name|ivyfile
init|=
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
decl_stmt|;
name|File
name|art
init|=
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
decl_stmt|;
name|FileUtil
operator|.
name|copy
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-mod1.2.xml"
argument_list|)
argument_list|,
name|ivyfile
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|FileUtil
operator|.
name|copy
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.2/jars/mod1.2-2.0.jar"
argument_list|)
argument_list|,
name|art
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testChangeCacheLayout
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|setCacheIvyPattern
argument_list|(
literal|"[module]/ivy.xml"
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|setCacheArtifactPattern
argument_list|(
literal|"[artifact].[ext]"
argument_list|)
expr_stmt|;
comment|// mod1.1 depends on mod1.2
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.1/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"mod1.2/ivy.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"mod1.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.1 depends on mod1.2 2.0 in conf default, and conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"extension"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies from default
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExtended
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.1 depends on mod1.2 2.0 in conf default, and conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies from default
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExtendedAndExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.1 depends on mod1.2 2.0 in conf default, and conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"extension"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"extension"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveMultipleExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.2  has two confs default and extension
comment|//    mod6.2 depends on mod6.1 in conf (default->extension)
comment|//   conf extension extends default
comment|// mod6.1 has two confs default and extension
comment|//   mod6.1 depends on mod1.2 2.0 in conf (default->default)
comment|//   conf extension extends default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.2/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"extension"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"extension"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.4"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.4"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveMultipleExtendsAndConfs
parameter_list|()
throws|throws
name|Exception
block|{
comment|// Test case for IVY-240
comment|//
comment|// mod6.3 1.1 has four confs libraries, run (extends libraries), compile (extends run) and test (extends libraries)
comment|//    mod6.3 depends on mod6.2 2.0 in conf (run->default)
comment|//    mod6.3 depends on mod6.1 2.+ in conf (test->default)
comment|// mod6.2 2.0 depends on mod6.1 2.0 in conf (default->standalone)
comment|// mod6.1 2.0 has two confs default and standalone
comment|//   mod6.1 2.0 depends on mod1.2 2.2 in conf (default->default)
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.3/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"libraries"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"run"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|crr
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|crr
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"compile"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|crr
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|crr
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"test"
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|crr
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|,
name|crr
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveMultipleConfsWithLatest
parameter_list|()
throws|throws
name|Exception
block|{
comment|// Test case for IVY-188
comment|//
comment|// mod6.2  has two confs compile and run
comment|//    depends on mod6.1     in conf (compile->default)
comment|//    depends on mod1.2 latest (which is 2.2) in conf (run->default)
comment|// mod6.1
comment|//    depends on mod1.2 2.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.2/ivys/ivy-0.6.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"compile"
block|,
literal|"run"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"compile"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"run"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveMultipleConfsWithConflicts
parameter_list|()
throws|throws
name|Exception
block|{
comment|// Test case for IVY-173
comment|//
comment|// mod6.2  has two confs compile and run
comment|//    depends on mod1.2 2.1 in conf (compile->default)
comment|//    depends on mod1.1 1.0 in conf (*->default)
comment|//    depends on mod6.1     in conf (*->default)
comment|// mod6.1
comment|//    depends on mod1.2 2.1
comment|// mod1.1
comment|//    depends on mod1.2 2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.2/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"compile"
block|,
literal|"run"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"compile"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"run"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.5"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.5"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveMultipleExtends2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as before, except that mod6.2 depends on mod1.2 2.1 extension->default
comment|// so mod1.2 2.0 should be evicted in conf extension
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org6/mod6.2/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"extension"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.2"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|IvyNode
name|node
init|=
name|crr
operator|.
name|getDependency
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|node
operator|.
name|isEvicted
argument_list|(
literal|"default"
argument_list|)
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"extension"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|node
operator|=
name|crr
operator|.
name|getDependency
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|node
operator|.
name|isEvicted
argument_list|(
literal|"extension"
argument_list|)
argument_list|)
expr_stmt|;
name|node
operator|=
name|crr
operator|.
name|getDependency
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|node
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|node
operator|.
name|isEvicted
argument_list|(
literal|"extension"
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.4"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"0.4"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDefaultWithArtifactsConf1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.2 depends on mod1.3 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.2/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.2"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDefaultWithArtifactsConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.2 depends on mod1.3 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.2/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.2"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3-B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"3.0"
argument_list|,
literal|"mod1.3"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithDependencyArtifactsConf1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts in myconf1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf1"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithDependencyArtifactsConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts in myconf1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"myconf2"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithDependencyArtifactsWithoutConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithExcludesArtifacts
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and selects its artifacts
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.6.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.6"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithExcludesArtifacts2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and badly excludes artifacts with incorrect matcher
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.6.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.6.2"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithExcludesArtifacts3
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and excludes artifacts with exact matcher
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.6.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.6.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithExcludesArtifacts4
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and excludes artifacts with regexp matcher
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.6.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.6.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveWithExcludesArtifacts5
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.3 depends on mod2.1 and excludes artifacts with glob matcher
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.3/ivys/ivy-0.6.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.6.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveDependencies
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.1 depends on mod1.1 which depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.1/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testDependenciesOrder
parameter_list|()
throws|throws
name|Exception
block|{
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-225.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|Set
name|revisions
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getModuleRevisionIds
argument_list|()
decl_stmt|;
name|assertTrue
argument_list|(
literal|"number of revisions is not correct"
argument_list|,
name|revisions
operator|.
name|size
argument_list|()
operator|>=
literal|3
argument_list|)
expr_stmt|;
comment|// verify the first 3 modules against the ones in the ivy file
name|Iterator
name|it
init|=
name|revisions
operator|.
name|iterator
argument_list|()
decl_stmt|;
name|ModuleRevisionId
name|revId1
init|=
operator|(
name|ModuleRevisionId
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|"mod1.2"
argument_list|,
name|revId1
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.1"
argument_list|,
name|revId1
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|revId2
init|=
operator|(
name|ModuleRevisionId
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|"mod3.2"
argument_list|,
name|revId2
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1.4"
argument_list|,
name|revId2
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|revId3
init|=
operator|(
name|ModuleRevisionId
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|"mod5.1"
argument_list|,
name|revId3
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"4.2"
argument_list|,
name|revId3
operator|.
name|getRevision
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testDisableTransitivityPerConfiguration
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.1 (compile, runtime) depends on mod1.1 which depends on mod1.2
comment|// compile conf is not transitive
comment|// first we resolve compile conf only
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.1/ivys/ivy-0.3.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"compile"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// then we resolve runtime conf
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.1/ivys/ivy-0.3.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"runtime"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDiamond
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 depends on
comment|//   - mod1.1 which depends on mod1.2
comment|//   - mod3.1 which depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveConflict
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.1 depends on
comment|//   - mod1.1 v 1.0 which depends on mod1.2 v 2.0
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|File
name|r
init|=
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
name|XmlReportOutputter
operator|.
name|getReportFileName
argument_list|(
name|mrid
operator|.
name|getModuleId
argument_list|()
argument_list|,
literal|"default"
argument_list|)
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|r
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
specifier|final
name|boolean
index|[]
name|found
init|=
operator|new
name|boolean
index|[]
block|{
literal|false
block|}
decl_stmt|;
name|SAXParser
name|saxParser
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|r
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
block|{
specifier|public
name|void
name|startElement
parameter_list|(
name|String
name|uri
parameter_list|,
name|String
name|localName
parameter_list|,
name|String
name|qName
parameter_list|,
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|Attributes
name|attributes
parameter_list|)
throws|throws
name|SAXException
block|{
if|if
condition|(
literal|"revision"
operator|.
name|equals
argument_list|(
name|qName
argument_list|)
operator|&&
literal|"2.0"
operator|.
name|equals
argument_list|(
name|attributes
operator|.
name|getValue
argument_list|(
literal|"name"
argument_list|)
argument_list|)
condition|)
block|{
name|found
index|[
literal|0
index|]
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|found
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|// the report should contain the evicted revision
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testTransitiveEviction
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod7.3 depends on mod7.2 v1.0 and on mod7.1 v2.0
comment|//      mod7.2 v1.0 depends on mod7.1 v1.0 (which then should be evicted)
comment|//      mod7.1 v1.0 depends on mod 1.2 v1.0 (which should be evicted by transitivity)
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod7.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org7"
argument_list|,
literal|"mod7.3"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org7"
argument_list|,
literal|"mod7.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org7"
argument_list|,
literal|"mod7.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod7.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org7"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org7"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org7"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod7.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testTransitiveEviction2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-199
comment|// mod4.1 v 4.13 depends on
comment|//   - mod3.2 v 1.2.1 which depends on
comment|//         - mod3.1 v 1.0 which depends on mod1.2 v 2.0
comment|//         - mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.13.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveConflictInConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// conflicts in separate confs are not conflicts
comment|// mod2.1 conf A depends on mod1.1 which depends on mod1.2 2.0
comment|// mod2.1 conf B depends on mod1.2 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.1/ivys/ivy-0.4.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.4"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// bug 105 - test #1
comment|// mod6.1 r1.0 depends on
comment|//       mod5.1 r4.2 conf A
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// should have been evicted before download
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as preceding one but with inverse order, so that
comment|// eviction is done after download
comment|// bug 105 - test #2
comment|// mod6.1 r1.1 depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//       mod5.1 r4.2 conf A
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConfInMultiConf
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as preceding ones but the conflict appears in several root confs
comment|// bug 105 - test #3
comment|// mod6.1 r1.2 conf A and conf B depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//       mod5.1 r4.2 conf A
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.2"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// all artifacts should be present in both confs
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"A"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"B"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testEvictWithConfInMultiConf2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as preceding one but the conflict appears in a root conf and not in another
comment|// which should keep the evicted
comment|// bug 105 - test #4
comment|// mod6.1 r1.3 conf A depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//
comment|// mod6.1 r1.3 conf B depends on
comment|//       mod5.2 r1.0 which depends on mod5.1 r4.0 conf B
comment|//       mod5.1 r4.2 conf A
comment|//
comment|//       mod5.1 r4.2 conf B depends on mod1.2 r2.0
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.1/ivy-1.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.1"
argument_list|,
literal|"1.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// 4.2 artifacts should be present in conf B only
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"A"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"B"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.2"
argument_list|)
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForce
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.2 depends on
comment|//   - mod1.2 v 2.0 and forces it
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.2"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceAfterConflictSolved
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-193
comment|// mod4.1 v 4.9 depends on
comment|//   - mod3.2 v 1.1 which depends on mod1.2 v 2.0
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
comment|//   - mod1.2 v 2.0 and forces it
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.9.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.9"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceAfterDependencyExist
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-193
comment|// mod4.1 v 4.10 depends on
comment|//   - mod3.1 v 1.0.1 which depends on mod1.2 v 2.0 and forces it
comment|//   - mod3.2 v 1.2 which depends on mod1.2 v 2.1 and on mod3.1 v1.0.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.10.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceInDepOnly
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-193
comment|// mod4.1 v 4.11 depends on
comment|//   - mod1.2 v 2.0
comment|//   - mod3.2 v 1.3 which depends on
comment|//          - mod3.1 v1.1 which depends on
comment|//                  - mod1.2 v 2.1
comment|//          - mod1.2 v 1.0 and forces it
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.11.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceInDepOnly2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-193
comment|// mod4.1 v 4.12 depends on
comment|//   - mod3.1 v1.0 which depends on
comment|//          - mod1.2 v 2.0
comment|//   - mod3.2 v 1.4 which depends on
comment|//          - mod1.2 v 2.0 and forces it
comment|//          - mod3.1 v1.1 which depends on
comment|//                  - mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.12.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceWithDynamicRevisions
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.5 depends on
comment|//   - mod1.2 v 1+ and forces it
comment|//   - mod3.1 v 1.2 which depends on mod1.2 v 2+
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.5.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.5"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.2"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceWithDynamicRevisionsAndSeveralConfs
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.6 (conf compile, test extends compile) depends on
comment|//   - mod1.2 v 1+ and forces it in conf compile
comment|//   - mod3.1 v 1.2 in conf test which depends on mod1.2 v 2+
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.6.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.6"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.2"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceWithDynamicRevisionsAndSeveralConfs2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod4.1 v 4.7 (conf compile, test extends compile) depends on
comment|//   - mod1.2 v 1+ and forces it in conf compile
comment|//   - mod3.1 v 1.3 in conf test->runtime
comment|//           which defines confs compile, runtime extends compile
comment|//           which depends on mod1.2 v 2+ in conf compile->default
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod4.1/ivy-4.7.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org4"
argument_list|,
literal|"mod4.1"
argument_list|,
literal|"4.7"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveForceWithDynamicRevisionsAndCyclicDependencies
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-182
comment|//   * has no revision
comment|//   * declares conf compile, test extends compile,
comment|//   * depends on
comment|//     - mod1.2 v 1+ and forces it in conf compile
comment|//     - mod3.1 v 1+ in conf test->runtime excluding mod4.1 (to avoid cyclic dep failure)
comment|//           which defines confs compile, runtime extends compile
comment|//           which depends on mod1.2 v 2+ in conf compile->default
comment|//           which depends on mod4.1 v 4+ in conf compile->compile
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-182.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleId
name|mid
init|=
operator|new
name|ModuleId
argument_list|(
literal|"test"
argument_list|,
literal|"IVY-182"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|getModuleId
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.4"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org3"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"1.4"
argument_list|,
literal|"mod3.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveContradictoryConflictResolution
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod10.1 v 1.0 depends on
comment|//   - mod1.2 v 2.0 and forces it
comment|//   - mod4.1 v 4.1 (which selects mod1.2 v 2.1 and evicts mod1.2 v 2.0)
comment|// mod4.1 v 4.1 depends on
comment|//   - mod1.1 v 1.0 which depends on mod1.2 v 2.0
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.1/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org10"
argument_list|,
literal|"mod10.1"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// conflicting dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveContradictoryConflictResolution2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// BUG IVY-130 : only mod1.2 v2.0 should be resolved and not v2.1 (because of force)
comment|// mod10.1 v 1.1 depends on
comment|//   - mod1.2 v 2.0 and forces it
comment|//   - mod4.1 v 4.3
comment|// mod4.1 v 4.3 depends on
comment|//   - mod1.2 v 2.1
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.1/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// conflicting dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveContradictoryConflictResolution3
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 1.2 v2.0 should be selected (despite conflict manager in 4.1, because of force in 10.1)
comment|// mod10.1 v 1.3 depends on
comment|//   - mod1.2 v 2.0 and forces it
comment|//   - mod4.1 v 4.4
comment|// mod4.1 v 4.4 depends on
comment|//   - mod1.2 v 2.0 but selects mod1.2 v 2.1
comment|//   - mod3.1 v 1.1 which depends on mod1.2 v 2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.1/ivy-1.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|IvyNode
index|[]
name|evicted
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
operator|.
name|getEvictedNodes
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|evicted
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.1"
argument_list|)
argument_list|,
name|evicted
index|[
literal|0
index|]
operator|.
name|getResolvedId
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testExtends
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 5.2 depends on mod5.1 conf B
comment|// mod5.1 conf B publishes art51B
comment|// mod5.1 conf B extends conf A
comment|// mod5.1 conf A publishes art51A
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod5.2/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testMultiConfs
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 5.2 depends on mod5.1 conf B in its conf B and conf A in its conf A
comment|// mod5.1 conf B publishes art51B
comment|// mod5.1 conf A publishes art51A
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod5.2/ivy-2.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"B"
block|,
literal|"A"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.2"
argument_list|,
literal|"2.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ModuleRevisionId
name|depId
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"A"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|depId
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|File
name|r
init|=
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
name|XmlReportOutputter
operator|.
name|getReportFileName
argument_list|(
name|mrid
operator|.
name|getModuleId
argument_list|()
argument_list|,
literal|"A"
argument_list|)
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|r
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
specifier|final
name|boolean
index|[]
name|found
init|=
operator|new
name|boolean
index|[]
block|{
literal|false
block|}
decl_stmt|;
name|SAXParser
name|saxParser
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|r
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
block|{
specifier|public
name|void
name|startElement
parameter_list|(
name|String
name|uri
parameter_list|,
name|String
name|localName
parameter_list|,
name|String
name|qName
parameter_list|,
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|Attributes
name|attributes
parameter_list|)
throws|throws
name|SAXException
block|{
if|if
condition|(
literal|"artifact"
operator|.
name|equals
argument_list|(
name|qName
argument_list|)
operator|&&
literal|"art51B"
operator|.
name|equals
argument_list|(
name|attributes
operator|.
name|getValue
argument_list|(
literal|"name"
argument_list|)
argument_list|)
condition|)
block|{
name|found
index|[
literal|0
index|]
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|found
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|depId
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testThisConfiguration
parameter_list|()
throws|throws
name|Exception
block|{
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod14.4/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"compile"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.4"
argument_list|,
literal|"1.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"compile"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.3"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org8"
argument_list|,
literal|"mod8.3"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|cleanCache
argument_list|()
expr_stmt|;
name|createCache
argument_list|()
expr_stmt|;
name|report
operator|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod14.4/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"standalone"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|crr
operator|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"standalone"
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|7
argument_list|,
name|crr
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.3"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.1"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org14"
argument_list|,
literal|"mod14.3"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org8"
argument_list|,
literal|"mod8.3"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org8"
argument_list|,
literal|"mod8.4"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org8"
argument_list|,
literal|"mod8.2"
argument_list|,
literal|"1.1"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testLatest
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod1.4 depends on latest mod1.2
specifier|final
name|Collection
name|asked
init|=
operator|new
name|ArrayList
argument_list|()
decl_stmt|;
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|LatestConflictManager
name|latestConflictManager
init|=
operator|new
name|LatestConflictManager
argument_list|(
literal|"test"
argument_list|,
operator|new
name|LatestRevisionStrategy
argument_list|()
argument_list|)
block|{
specifier|public
name|Collection
name|resolveConflicts
parameter_list|(
name|IvyNode
name|parent
parameter_list|,
name|Collection
name|conflicts
parameter_list|)
block|{
for|for
control|(
name|Iterator
name|iter
init|=
name|conflicts
operator|.
name|iterator
argument_list|()
init|;
name|iter
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|IvyNode
name|node
init|=
operator|(
name|IvyNode
operator|)
name|iter
operator|.
name|next
argument_list|()
decl_stmt|;
name|asked
operator|.
name|add
argument_list|(
name|node
operator|.
name|getResolvedId
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|super
operator|.
name|resolveConflicts
argument_list|(
name|parent
argument_list|,
name|conflicts
argument_list|)
return|;
block|}
block|}
decl_stmt|;
name|ivy
operator|.
name|setDefaultConflictManager
argument_list|(
name|latestConflictManager
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.4/ivys/ivy-1.0.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.4"
argument_list|,
literal|"1.0.1"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ModuleRevisionId
name|depId
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|asked
operator|.
name|contains
argument_list|(
name|depId
argument_list|)
argument_list|)
expr_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|depId
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|File
name|r
init|=
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
name|XmlReportOutputter
operator|.
name|getReportFileName
argument_list|(
name|mrid
operator|.
name|getModuleId
argument_list|()
argument_list|,
literal|"default"
argument_list|)
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|r
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
specifier|final
name|boolean
index|[]
name|found
init|=
operator|new
name|boolean
index|[]
block|{
literal|false
block|}
decl_stmt|;
name|SAXParser
name|saxParser
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|r
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
block|{
specifier|public
name|void
name|startElement
parameter_list|(
name|String
name|uri
parameter_list|,
name|String
name|localName
parameter_list|,
name|String
name|qName
parameter_list|,
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|Attributes
name|attributes
parameter_list|)
throws|throws
name|SAXException
block|{
if|if
condition|(
literal|"artifact"
operator|.
name|equals
argument_list|(
name|qName
argument_list|)
operator|&&
literal|"mod1.2"
operator|.
name|equals
argument_list|(
name|attributes
operator|.
name|getValue
argument_list|(
literal|"name"
argument_list|)
argument_list|)
condition|)
block|{
name|found
index|[
literal|0
index|]
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|found
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|depId
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.2"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testVersionRange1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 1.4 depends on mod1.2 [1.0,2.0[
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.4/ivys/ivy-1.0.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ModuleRevisionId
name|depId
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"1.1"
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|depId
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|depId
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testVersionRange2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 1.4 depends on mod1.2 [1.5,2.0[
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org1/mod1.4/ivys/ivy-1.0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testLatestMilestone
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod9.2 depends on latest.milestone of mod6.4
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org9/mod9.2/ivys/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|ModuleRevisionId
name|depId
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org6"
argument_list|,
literal|"mod6.4"
argument_list|,
literal|"3"
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|crr
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|crr
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|crr
operator|.
name|getDownloadReports
argument_list|(
name|depId
argument_list|)
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|depId
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testIVY56
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bugIVY-56/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-56.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testIVY214
parameter_list|()
throws|throws
name|Exception
block|{
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-214.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"compile"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Number of artifacts not correct"
argument_list|,
literal|1
argument_list|,
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"compile"
argument_list|)
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testIVY218
parameter_list|()
throws|throws
name|Exception
block|{
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-218.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Number of artifacts not correct"
argument_list|,
literal|3
argument_list|,
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"test"
argument_list|)
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testCircular
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod6.3 depends on mod6.2, which itself depends on mod6.3
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|_ivy
operator|.
name|setCircularDependencyStrategy
argument_list|(
name|IgnoreCircularDependencyStrategy
operator|.
name|getInstance
argument_list|()
argument_list|)
expr_stmt|;
name|report
operator|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|_ivy
operator|.
name|setCircularDependencyStrategy
argument_list|(
name|WarnCircularDependencyStrategy
operator|.
name|getInstance
argument_list|()
argument_list|)
expr_stmt|;
name|report
operator|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|_ivy
operator|.
name|setCircularDependencyStrategy
argument_list|(
name|ErrorCircularDependencyStrategy
operator|.
name|getInstance
argument_list|()
argument_list|)
expr_stmt|;
try|try
block|{
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod6.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"no exception with circular dependency strategy set to error"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|CircularDependencyException
name|ex
parameter_list|)
block|{
name|assertEquals
argument_list|(
literal|"[ org6 | mod6.3 | 1.0 ]->[ org6 | mod6.2 | 1.0 ]->[ org6 | mod6.3 | latest.integration ]"
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
specifier|public
name|void
name|testCircular2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod 9.1 (no revision) depends on mod9.2, which depends on mod9.1 2.+
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/circular/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|_ivy
operator|.
name|setCircularDependencyStrategy
argument_list|(
name|ErrorCircularDependencyStrategy
operator|.
name|getInstance
argument_list|()
argument_list|)
expr_stmt|;
try|try
block|{
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/circular/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"no exception with circular dependency strategy set to error"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|CircularDependencyException
name|ex
parameter_list|)
block|{
comment|// ok
name|assertEquals
argument_list|(
literal|"[ org8 | mod8.5 | NONE ]->[ org8 | mod8.6 | 2.+ ]->[ org8 | mod8.5 | 2.+ ]"
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
specifier|public
name|void
name|testRegularCircular
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod11.1 depends on mod11.2 but excludes itself
comment|// mod11.2 depends on mod11.1
name|_ivy
operator|.
name|setCircularDependencyStrategy
argument_list|(
name|ErrorCircularDependencyStrategy
operator|.
name|getInstance
argument_list|()
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod11.1/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"test"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org11"
argument_list|,
literal|"mod11.2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org11"
argument_list|,
literal|"mod11.2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod11.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org11"
argument_list|,
literal|"mod11.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org11"
argument_list|,
literal|"mod11.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod11.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveDualChain
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"dualchainresolverconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|DependencyResolver
name|resolver
init|=
name|ivy
operator|.
name|getResolver
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|resolver
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|resolver
operator|instanceof
name|DualResolver
argument_list|)
expr_stmt|;
comment|// first without cache
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-dualchainresolver.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/ivy-2.6.2.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// second with cache for ivy file only
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|assertFalse
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-dualchainresolver.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/ivy-2.6.2.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xmlParserAPIs-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/xerces/xerces/jars/xercesImpl-2.6.2.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBug148
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bug148/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-148.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/ivy-1.1.0.0.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/jars/bar-1.1.0.0.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/ivy-4.10.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/jars/LinearBarCode-4.10.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBug148b
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/bug148/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-148b.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/ivy-1.1.0.0.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/jtv-foo/bar/jars/bar-1.1.0.0.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/ivy-4.10.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
literal|"build/cache/idautomation/barcode/jars/LinearBarCode-4.10.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testBadFiles
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
try|try
block|{
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivys/ivy-badorg.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad org should have raised an exception !"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|// OK, it raised an exception
block|}
try|try
block|{
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivys/ivy-badmodule.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad module should have raised an exception !"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|// OK, it raised an exception
block|}
try|try
block|{
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/badfile/ivys/ivy-badrevision.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
operator|new
name|File
argument_list|(
literal|"build/cache"
argument_list|)
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fail
argument_list|(
literal|"bad revision should have raised an exception !"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|// OK, it raised an exception
block|}
block|}
specifier|public
name|void
name|testTransitiveSetting
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.4 depends on mod1.1 with transitive set to false
comment|//     mod1.1 depends on mod1.2, which should not be resolved because of the transitive setting
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.4/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.4"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolverDirectlyUsingCache
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"badcacheconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|File
name|depIvyFileInCache
init|=
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
decl_stmt|;
name|FileUtil
operator|.
name|copy
argument_list|(
name|File
operator|.
name|createTempFile
argument_list|(
literal|"test"
argument_list|,
literal|"xml"
argument_list|)
argument_list|,
name|depIvyFileInCache
argument_list|,
literal|null
argument_list|)
expr_stmt|;
comment|// creates a fake dependency file in cache
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.4/ivys/ivy-0.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.4"
argument_list|,
literal|"0.3"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|depIvyFileInCache
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|!
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testVisibility1
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod8.2/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"a-private"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testVisibility2
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod8.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"private"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"a-private"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testVisibility3
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod8.4/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"a-private"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testVisibility4
parameter_list|()
throws|throws
name|Exception
block|{
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod8.4/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.1"
argument_list|,
literal|"a-private"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org8"
argument_list|,
literal|"mod8.1"
argument_list|,
literal|"1.1"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|///////////////////////////////////////////////////////////
comment|// here comes a series of test provided by Chris Rudd
comment|// about configuration mapping and eviction
comment|///////////////////////////////////////////////////////////
specifier|public
name|void
name|testConfigurationMapping1
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/1/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testConfigurationMapping2
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/2/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testConfigurationMapping3
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/3/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"buildtime"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"buildtime"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testConfigurationMapping4
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/4/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testConfigurationMapping5
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/5/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testConfigurationMapping6
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/6/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"default"
block|,
literal|"buildtime"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testConfigurationMapping7
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/IVY-84/tests/7/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"buildtime"
block|,
literal|"default"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ConfigurationResolveReport
name|conf
init|=
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"default"
argument_list|)
decl_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"a"
argument_list|,
literal|"1.0.2"
argument_list|,
literal|"a-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"b"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"b-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertContainsArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
name|assertDoesntContainArtifact
argument_list|(
literal|"test"
argument_list|,
literal|"c"
argument_list|,
literal|"1.0.1"
argument_list|,
literal|"c-bt"
argument_list|,
literal|"txt"
argument_list|,
literal|"txt"
argument_list|,
name|conf
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testIVY97
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod9.2 depends on mod9.1 and mod1.2
comment|//     mod9.1 depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org9/mod9.2/ivys/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org9"
argument_list|,
literal|"mod9.2"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org9"
argument_list|,
literal|"mod9.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org9"
argument_list|,
literal|"mod9.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod9.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveExcludesSimple
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.5 depends on mod2.3 and excludes one artifact from mod2.1
comment|//      mod2.3 depends on mod2.1
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.5/ivys/ivy-0.6.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.5"
argument_list|,
literal|"0.6"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.7"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"0.7"
argument_list|,
literal|"mod2.3"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveExcludesDiamond1
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.6 depends on mod2.3 and mod2.5
comment|//      mod2.3 depends on mod2.1 and excludes art21B
comment|//      mod2.5 depends on mod2.1 and excludes art21A
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.6/ivys/ivy-0.6.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveExcludesDiamond2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.6 depends on mod2.3 and mod2.5
comment|//      mod2.3 depends on mod2.1 and excludes art21B
comment|//      mod2.5 depends on mod2.1 and excludes art21B
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.6/ivys/ivy-0.7.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveExcludesDiamond3
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.6 depends on mod2.3 and mod2.5 and on mod2.1 for which it excludes art21A
comment|//      mod2.3 depends on mod2.1 and excludes art21B
comment|//      mod2.5 depends on mod2.1 and excludes art21B
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.6/ivys/ivy-0.8.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveTransitiveExcludes2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.6 depends on mod2.3 for which it excludes art21A
comment|//      mod2.3 depends on mod2.1 and excludes art21B
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.6/ivys/ivy-0.9.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.6"
argument_list|,
literal|"0.9"
argument_list|)
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org2"
argument_list|,
literal|"mod2.1"
argument_list|,
literal|"0.3"
argument_list|,
literal|"art21B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExcludesModule
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod2.6 depends on mod2.1 and excludes mod1.1
comment|//      mod2.1 depends on mod1.1 which depends on mod1.2
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/1/org2/mod2.6/ivys/ivy-0.10.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org2"
argument_list|,
literal|"mod2.6"
argument_list|,
literal|"0.10"
argument_list|)
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod1.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveExceptConfiguration
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod10.2 depends on mod5.1 conf *, !A
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.2/ivy-2.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.1"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveFallbackConfiguration
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod10.2 depends on mod5.1 conf runtime(default)
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.2/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveFallbackConfiguration2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod10.2 depends on mod5.1 conf runtime(*)
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.2/ivy-1.1.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveFallbackConfiguration3
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod10.2 depends on mod5.1 conf runtime(*),compile(*)
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.2/ivy-1.2.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveFallbackConfiguration4
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod10.2 depends on mod5.1 conf runtime()
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod10.2/ivy-1.3.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org5"
argument_list|,
literal|"mod5.1"
argument_list|,
literal|"4.0"
argument_list|,
literal|"art51B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testResolveMaven2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// test3 depends on test2 which depends on test
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/m2/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/m2/fr/jayasoft/test3/1.0/test3-1.0.pom"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"fr.jayasoft"
argument_list|,
literal|"test3"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"fr.jayasoft"
argument_list|,
literal|"test2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"fr.jayasoft"
argument_list|,
literal|"test2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"test2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"fr.jayasoft"
argument_list|,
literal|"test"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"fr.jayasoft"
argument_list|,
literal|"test"
argument_list|,
literal|"1.0"
argument_list|,
literal|"test"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testNamespaceMapping
parameter_list|()
throws|throws
name|Exception
block|{
comment|// the dependency is in another namespace
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/namespace/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-namespace.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"jayasoft"
argument_list|,
literal|"namespace"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"systemorg"
argument_list|,
literal|"systemmod"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"systemorg"
argument_list|,
literal|"systemmod"
argument_list|,
literal|"1.0"
argument_list|,
literal|"A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testNamespaceMapping2
parameter_list|()
throws|throws
name|Exception
block|{
comment|// the dependency is in another namespace and has itself a dependency on a module available in the same namespace
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/namespace/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-namespace2.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"jayasoft"
argument_list|,
literal|"namespace"
argument_list|,
literal|"2.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"systemorg"
argument_list|,
literal|"systemmod2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"systemorg"
argument_list|,
literal|"systemmod2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"B"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"systemorg"
argument_list|,
literal|"systemmod"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"systemorg"
argument_list|,
literal|"systemmod"
argument_list|,
literal|"1.0"
argument_list|,
literal|"A"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testNamespaceMapping3
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as 2 but with poms
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/namespace/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-namespace3.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"jayasoft"
argument_list|,
literal|"namespace"
argument_list|,
literal|"3.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getResolvedIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|mrid
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
comment|// dependencies
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"systemorg2"
argument_list|,
literal|"system-2"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"systemorg2"
argument_list|,
literal|"system-2"
argument_list|,
literal|"1.0"
argument_list|,
literal|"2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"systemorg2"
argument_list|,
literal|"system-1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"systemorg2"
argument_list|,
literal|"system-1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testNamespaceMapping4
parameter_list|()
throws|throws
name|Exception
block|{
comment|// same as 2 but with incorrect dependency asked: the first ivy file asks for a dependency
comment|// in the resolver namespace and not the system one: this should fail
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/namespace/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-namespace4.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|ModuleDescriptor
name|md
init|=
name|report
operator|.
name|getModuleDescriptor
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
name|md
argument_list|)
expr_stmt|;
name|ModuleRevisionId
name|mrid
init|=
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"jayasoft"
argument_list|,
literal|"namespace"
argument_list|,
literal|"4.0"
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|mrid
argument_list|,
name|md
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testIVY151
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/multirevisions/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/multirevisions/ivy.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"compile"
block|,
literal|"test"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|report
operator|.
name|getUnresolvedDependencies
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Number of unresolved dependencies not correct"
argument_list|,
literal|0
argument_list|,
name|report
operator|.
name|getUnresolvedDependencies
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testCheckRevision
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod12.2 depends on mod12.1 1.0 which depends on mod1.2
comment|// mod12.1 doesn't have revision in its ivy file
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod12.2/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org12"
argument_list|,
literal|"mod12.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org12"
argument_list|,
literal|"mod12.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod12.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testTrustRevision
parameter_list|()
throws|throws
name|Exception
block|{
comment|// mod12.2 depends on mod12.1 1.0 which depends on mod1.2
comment|// mod12.1 doesn't have revision in its ivy file
operator|(
operator|(
name|BasicResolver
operator|)
name|_ivy
operator|.
name|getResolver
argument_list|(
literal|"2-ivy"
argument_list|)
operator|)
operator|.
name|setCheckconsistency
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod12.2/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org12"
argument_list|,
literal|"mod12.1"
argument_list|,
literal|"1.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org12"
argument_list|,
literal|"mod12.1"
argument_list|,
literal|"1.0"
argument_list|,
literal|"mod12.1"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getIvyFileInCache
argument_list|(
name|_cache
argument_list|,
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|)
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|_ivy
operator|.
name|getArchiveFileInCache
argument_list|(
name|_cache
argument_list|,
literal|"org1"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"2.0"
argument_list|,
literal|"mod1.2"
argument_list|,
literal|"jar"
argument_list|,
literal|"jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testTransitiveConfMapping
parameter_list|()
throws|throws
name|Exception
block|{
comment|// IVY-168
comment|// mod13.3 depends on mod13.2 which depends on mod13.1
comment|// each module has two confs: j2ee and compile
comment|// each module only publishes one artifact in conf compile
comment|// each module has the following conf mapping on its dependencies: *->@
comment|// moreover, mod13.1 depends on mod1.2 in with the following conf mapping: compile->default
comment|// thus conf j2ee should be empty for each modules
name|ResolveReport
name|report
init|=
name|_ivy
operator|.
name|resolve
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/2/mod13.3/ivy-1.0.xml"
argument_list|)
operator|.
name|toURL
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"compile"
argument_list|)
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|report
operator|.
name|getConfigurationReport
argument_list|(
literal|"j2ee"
argument_list|)
operator|.
name|getArtifactsNumber
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testExtraAttributes
parameter_list|()
throws|throws
name|Exception
block|{
name|Ivy
name|ivy
init|=
operator|new
name|Ivy
argument_list|()
decl_stmt|;
name|ivy
operator|.
name|configure
argument_list|(
operator|new
name|File
argument_list|(
literal|"test/repositories/extra-attributes/ivyconf.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|ResolveReport
name|report
init|=
name|ivy
operator|.
name|resolve
argument_list|(
name|ResolveTest
operator|.
name|class
operator|.
name|getResource
argument_list|(
literal|"ivy-extra-att.xml"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"*"
block|}
argument_list|,
name|_cache
argument_list|,
literal|null
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|report
operator|.
name|hasError
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"jayasoft/mymodule/task1/1854/ivy.xml"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"jayasoft/mymodule/task1/1854/mymodule-windows.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
operator|new
name|File
argument_list|(
name|_cache
argument_list|,
literal|"jayasoft/mymodule/task1/1854/mymodule-linux.jar"
argument_list|)
operator|.
name|exists
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|////////////////////////////////////////////////////////////
comment|// helper methods to ease the tests
comment|////////////////////////////////////////////////////////////
specifier|private
name|void
name|assertContainsArtifact
parameter_list|(
name|String
name|org
parameter_list|,
name|String
name|module
parameter_list|,
name|String
name|rev
parameter_list|,
name|String
name|artName
parameter_list|,
name|String
name|type
parameter_list|,
name|String
name|ext
parameter_list|,
name|ConfigurationResolveReport
name|conf
parameter_list|)
block|{
name|Artifact
name|art
init|=
name|getArtifact
argument_list|(
name|org
argument_list|,
name|module
argument_list|,
name|rev
argument_list|,
name|artName
argument_list|,
name|type
argument_list|,
name|ext
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|containsArtifact
argument_list|(
name|art
argument_list|,
name|conf
operator|.
name|getDownloadedArtifactsReports
argument_list|()
argument_list|)
condition|)
block|{
name|fail
argument_list|(
literal|"artifact "
operator|+
name|art
operator|+
literal|" should be part of "
operator|+
name|conf
operator|.
name|getConfiguration
argument_list|()
operator|+
literal|" from "
operator|+
name|conf
operator|.
name|getModuleDescriptor
argument_list|()
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
specifier|private
name|void
name|assertDoesntContainArtifact
parameter_list|(
name|String
name|org
parameter_list|,
name|String
name|module
parameter_list|,
name|String
name|rev
parameter_list|,
name|String
name|artName
parameter_list|,
name|String
name|type
parameter_list|,
name|String
name|ext
parameter_list|,
name|ConfigurationResolveReport
name|conf
parameter_list|)
block|{
name|Artifact
name|art
init|=
name|getArtifact
argument_list|(
name|org
argument_list|,
name|module
argument_list|,
name|rev
argument_list|,
name|artName
argument_list|,
name|type
argument_list|,
name|ext
argument_list|)
decl_stmt|;
if|if
condition|(
name|containsArtifact
argument_list|(
name|art
argument_list|,
name|conf
operator|.
name|getDownloadedArtifactsReports
argument_list|()
argument_list|)
condition|)
block|{
name|fail
argument_list|(
literal|"artifact "
operator|+
name|art
operator|+
literal|" should NOT be part of "
operator|+
name|conf
operator|.
name|getConfiguration
argument_list|()
operator|+
literal|" from "
operator|+
name|conf
operator|.
name|getModuleDescriptor
argument_list|()
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
specifier|private
name|Artifact
name|getArtifact
parameter_list|(
name|String
name|org
parameter_list|,
name|String
name|module
parameter_list|,
name|String
name|rev
parameter_list|,
name|String
name|artName
parameter_list|,
name|String
name|type
parameter_list|,
name|String
name|ext
parameter_list|)
block|{
return|return
operator|new
name|DefaultArtifact
argument_list|(
name|ModuleRevisionId
operator|.
name|newInstance
argument_list|(
name|org
argument_list|,
name|module
argument_list|,
name|rev
argument_list|)
argument_list|,
operator|new
name|Date
argument_list|()
argument_list|,
name|artName
argument_list|,
name|type
argument_list|,
name|ext
argument_list|)
return|;
block|}
specifier|private
name|boolean
name|containsArtifact
parameter_list|(
name|Artifact
name|art
parameter_list|,
name|ArtifactDownloadReport
index|[]
name|adr
parameter_list|)
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|adr
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|Artifact
name|artifact
init|=
name|adr
index|[
name|i
index|]
operator|.
name|getArtifact
argument_list|()
decl_stmt|;
if|if
condition|(
name|artifact
operator|.
name|getModuleRevisionId
argument_list|()
operator|.
name|equals
argument_list|(
name|art
operator|.
name|getModuleRevisionId
argument_list|()
argument_list|)
operator|&&
name|artifact
operator|.
name|getName
argument_list|()
operator|.
name|equals
argument_list|(
name|art
operator|.
name|getName
argument_list|()
argument_list|)
operator|&&
name|artifact
operator|.
name|getType
argument_list|()
operator|.
name|equals
argument_list|(
name|art
operator|.
name|getType
argument_list|()
argument_list|)
operator|&&
name|artifact
operator|.
name|getExt
argument_list|()
operator|.
name|equals
argument_list|(
name|art
operator|.
name|getExt
argument_list|()
argument_list|)
condition|)
block|{
return|return
literal|true
return|;
block|}
block|}
return|return
literal|false
return|;
block|}
block|}
end_class

end_unit

